#### 延时消息实现

##### 需求

在发起/完成任务后，n小时/n天后执行xxx

 

###### 方案

###### 轮询

隔一小时轮询执行任务

缺点：重复查询、浪费性能、可能存在时效问题

优点：相对稳定



###### loop

前置：

1、环形队列，3600格

2、task list，每一格都是一个task的list,里面存储执行的任务和Cycle-Num

3、current-index

 

运行：

每秒执行一次，每次current-index + 1,每次遍历taskList，Cycle-num为0的执行，否则减1

产生task的时候，根据延迟的时间计算出cycle-nul和cycle格子

 

优点：相对高效、通用、时效性好

缺点：主要task不能是耗时任务，需保持可用性，崩溃恢复



#### 数据变化监控

1、全量取数据到内存中

2、定时检查对比，找出差异项

3、推送通知

每天定时全量修正数据