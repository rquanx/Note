DSL 即「Domain Specific Language」，中文一般译为「领域特定语言」，在《领域特定语言》

[前端 DSL 实践指南](https://zhuanlan.zhihu.com/p/107947462)



### 外部

一种独立的编程语言，需要从解析器开始实现自己的编译工具，实现成本较高。但它的语法的灵活性更高，更容易达到用户的表现力需求。



外部 DSL 的直接对应就是 GPPL，由于受限语法特性更少，一般不要求图灵完备，所以它实现难度会低于 GPPL。

#### GPPL

General Purpose Programming Language，又称通用编程语言，例如我们常用的 JavaScript，它们被设计用来解决通用编程问题

> Sass、React、Vue 支持的 JSX 语法都属于外部 DSL



### 内部

Embedded DSL or Internal DSL，是建立在其它宿主语言之上（一般为 GPPL）的特殊 DSL，它与宿主语言共享编译与调试工具等基础设施，学习成本更低，也更容易被集成，别名：流畅接口。

**特点**

- 内部 DSL 的语法灵活度和语法噪音（syntactic noise）往往取决于宿主语言的选择
- 属于接口封装或库封装的一种模式，目标是极限表达力
- 设计的首要目标是「极限流畅的表现力」，而非职责清晰、降低耦合度等传统的封装抽象准则

例：JQ



#### 风格

##### 级联

特点：调用不再设计特定返回值，而是直接返回下一个上下文（通常是自身）

总结：无论是级联方法、级联管道还是级联属性，本质都是链式调用风格，链式调用的核心是上下文传递，所以每一次调用的返回实体是否符合用户的心智是 DSL 设计是否成功的重要依据。



###### 级联方法

> JQ



###### 级联管道

> gulp
>
> .pipe().pipe()...



###### 级联属性

###### 链式嵌套函数

场景：生成xml / html

如：CamlBuilder，不太好

> 只能使用有限的api，不便于扩展
>
> 在层级抽象中需额外的 end() 出栈动作实现上下文切换
>
> 可读性强依赖于手动缩进，而编辑器的自动缩进往往会打破这种和谐



##### 嵌套函数

链式嵌套函数拆分成多个子函数，互相之间不关联，通过嵌套使用

优势：容易映射成外部DSL

缺点：不适合流程、时间等顺序敏感的场景



##### 对象字面量

 js对象配置文件、json...

对象字面量的结构性较强，一般只用来做配置等数据抽象的场景，不适合用在过程抽象的场景



##### 动态代理

内部 DSL 的构造方式有一个典型缺陷就是它们都是静态定义的属性或方法，没有动态性

要实现这种特性，就强依赖宿主语言的元编程能力

例：proxy的动态命名方法



##### Lambda 表达式

linq

##### 自然语言抽象

本质是一些语法糖，chai、mocha、jest等

优点：自动根据链式调用产生的状态，自动拼装出更友好的错误信息